<html>
<head><title>Way too many for loops</title></head>
<body>
	<div id="towns"></div>
	<script src="js/jquery-2.1.1.min.js"></script>
	<script>
		url = "mapapi.php";
		$.getJSON(url, function (d) {
			var phplist = d.Towns;
			var phplength = phplist.length;
			for (var town = 0; town < phplength; town++) {
				var currenttown = phplist[town].Townname;
				geocode = 'https://maps.googleapis.com/maps/api/geocode/json?address=' + currenttown +'&reigon=au';
				$.getJSON(geocode, function (r) {
					var listlen = r.results.length;
					if (!listlen){
						return;
					}
					for (var i = 0; i < listlen; i++){
						var finalname, country;
						comp = r.results[i].address_components;
						for (var d = 0; d < comp.length; d++){
							e = r.results[i].address_components[d].types[0]
							// The townname has the type of 'locality'
							if (e == "locality") {
								final = r.results[0].address_components[i].long_name;
								console.log(final);
							}
							if (e == "country") {
								if (r.results[i].address_components[d].long_name == "Australia"){
									country = 1;
									console.log(country);
								}
							}
						}
						if (finalname && country){
							var lat = r.results[i].geometry.location.lat;
							var lng = r.results[i].geometry.location.lng;
							console.log(currenttown, lat, lng);
							$("#town").append(currenttown + ', ' + lat + ', ' + lng);
						}
					}
				});
			}
		});
	</script>
</body>
</html>