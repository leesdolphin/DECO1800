<html>
<head><title>Way too many for loops</title></head>
<body>
	<div id="towns"></div>
	<script src="js/jquery-2.1.1.min.js"></script>
	<script>
		var currenttown;
		url = "mapapi.php";
		$.getJSON(url, function (d) {
			var phplist = d.Towns;
			var phplength = phplist.length;
			for (var town = 0; town < phplength; town++) {
				currenttown = phplist[town].Townname;
				// console.log('town ', town, currenttown);
				geocode = 'https://maps.googleapis.com/maps/api/geocode/json?address=' + currenttown +'&reigon=au';
				$.getJSON(geocode, function (r) {
					//console.log(r);
					res = gettownname(r);
					if (res){
						var lat = r.results[0].geometry.location.lat;
						var lng = r.results[0].geometry.location.lng;
						$("#towns").append(res + ', ' + lat + ', ' + lng + '<br/>');
					}
				});
			}
		});
		
		function gettownname(r){
			//var listlen = r.results.length;
			comp = r.results[0].address_components;
			var finalname;
			for (var d = 0; d < comp.length; d++){
				e = r.results[0].address_components[d].types[0]
				if (e == "locality") {
					finalname = r.results[0].address_components[d].long_name;
					return finalname;
				}
			}
			return null;
		}
	</script>
</body>
</html>